- name: "Disable SElinux"
  selinux:
    state: disabled

- name: "Configure /etc/hosts file"
  template:
    src: hosts.j2
    dest: /etc/hosts

- name: "Install wget package"
  yum:
    name: wget.x86_64
    state: latest

- name: "Install vim package"
  yum:
    name: vim-common.x86_64
    state: latest

- name: "Add ambari repo"
  get_url:
    url: http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.7.0.0/ambari.repo
    dest: /etc/yum.repos.d/
    mode: 0644

- name: "Install AMBARI-SERVER package"
  yum:
    name: ambari-server.x86_64
    state: latest

- name: "Reboot if required"
  shell: sleep 2 && shutdown -r now 'Reboot required' removes=/var/run/reboot-required
  become: true
  async: 1
  poll: 0
  ignore_errors: true

- name: "Wait for reboot"
  local_action: wait_for host=127.0.0.1 port=2222 delay=10 state=started
  become: false

# sudo ambari-server setup
# OK to continue [y/n] (y)? y
# Customize user account for ambari-server daemon [y/n] (n)? y
# Enter user account for ambari-server daemon (root): ambari
# Enter choice (1): 1
# Do you accept the Oracle Binary Code License Agreement [y/n] (y)? y
# Enable Ambari Server to download and install GPL Licensed LZO packages [y/n] (n)? y
# Enter advanced database configuration [y/n] (n)? n
#
# sudo ambari-server start